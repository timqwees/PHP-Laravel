<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8" />
  <title>TimQwees Technology - Account</title>
  <meta content="Пройдите регистрацию, чтобы перейти в онлайн чат политеха" name="description" />
  <meta content="TimQwees Technology" property="og:title" />
  <meta content="Пройдите регистрацию, чтобы перейти в онлайн чат политеха" property="og:description" />
  <meta content="img/favicon.ico" property="og:image" />
  <meta property="og:type" content="website" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="css/style.css">
</head>

<body>
  <main>
    <div class="sidebar">
      <div class="profile">
        <div class="profile-img">
          <img src="https://cdn-icons-png.flaticon.com/512/3385/3385696.png" alt="Developer">
        </div>
        <div class="profile-info">
          <h2>TimQwees Technology</h2>
          <p>Группа:
            <?php echo htmlspecialchars($currentUser['group']); ?>
          </p>
        </div>
      </div>
      <div class="separator"></div>
      <nav>
        <ul>
          <li>
            <a href="#" class="active">
              <div class="icon-box">
                <ion-icon name="home-outline"></ion-icon>
              </div>
              <span>Главная</span>
            </a>
          </li>
          <li>
            <a href="#blog">
              <div class="icon-box">
                <ion-icon name="newspaper-outline"></ion-icon>
              </div>
              <span>Блог</span>
            </a>
          </li>
          <li>
            <a href="#settings">
              <div class="icon-box">
                <ion-icon name="settings-outline"></ion-icon>
              </div>
              <span>Настройки</span>
            </a>
          </li>
          <li>
            <a href="/public/logout.php">
              <div class="icon-box">
                <ion-icon name="log-out-outline"></ion-icon>
              </div>
              <span>Выход</span>
            </a>
          </li>
        </ul>
      </nav>
    </div>
    <div class="article_wrap">
      <article>
        <div class="content">
          <img
            src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/94/Apple_Developer_brandmark.svg/2560px-Apple_Developer_brandmark.svg.png"
            alt="Developer" height="100px">
          <div class="content-text">
            <span>Email:
              <?php echo htmlspecialchars($currentUser['username']); ?>!
            </span>
            <span>Вы <font style="color: rgb(122, 219, 100);">успешно</font> вошли в систему!</span>
          </div>
        </div>
      </article>

      <article id="blog">
        <div class="content">
          <h2>Блог</h2>
          <?php if (isset($_SESSION['success'])): ?>
          <div class="success">
            <?php echo $_SESSION['success'];
      unset($_SESSION['success']); ?>
          </div>
          <?php endif; ?>
          <?php if (isset($_SESSION['error'])): ?>
          <div class="error">
            <?php echo $_SESSION['error'];
      unset($_SESSION['error']); ?>
          </div>
          <?php endif; ?>

          <!-- Форма создания статьи -->
          <div class="create-article">
            <h3>Создать новую статью</h3>
            <form method="POST" action="">
              <div class="form-group">
                <label for="title">Заголовок:</label>
                <input type="text" id="title" name="title" required>
              </div>
              <div class="form-group">
                <label for="content">Содержание:</label>
                <textarea id="content" name="content" rows="5" required></textarea>
              </div>
              <button type="submit" name="create_article">Опубликовать</button>
            </form>
          </div>

          <!-- Список статей -->
          <div class="blog-posts">
            <?php if ($articles): ?>
            <?php foreach ($articles as $article): ?>
            <div class="post">
              <h3>
                <?php echo htmlspecialchars($article['title']); ?>
              </h3>
              <p>
                <?php echo nl2br(htmlspecialchars($article['content'])); ?>
              </p>
              <div class="post-meta">
                <span class="author">Автор:
                  <?php echo htmlspecialchars($article['username']); ?>
                </span>
                <span class="date">
                  <?php echo date('d.m.Y', strtotime($article['created_at'])); ?>
                </span>
              </div>
            </div>
            <?php endforeach; ?>
            <?php else: ?>
            <p>Пока нет статей</p>
            <?php endif; ?>
          </div>
        </div>
      </article>

      <article id="settings">
        <div class="content">
          <h2>Настройки профиля</h2>
          <?php if (isset($_SESSION['success'])): ?>
          <div class="success">
            <?php echo $_SESSION['success'];
      unset($_SESSION['success']); ?>
          </div>
          <?php endif; ?>
          <?php if (isset($_SESSION['error'])): ?>
          <div class="error">
            <?php echo $_SESSION['error'];
      unset($_SESSION['error']); ?>
          </div>
          <?php endif; ?>
          <form method="POST" action="">
            <div class="form-group">
              <label for="group">Номер группы:</label>
              <input type="number" id="group" name="group"
                value="<?php echo htmlspecialchars($currentUser['group']); ?>" min="100" max="999" required>
            </div>
            <button type="submit" name="update_profile">Сохранить изменения</button>
          </form>
        </div>

        <?php echo var_dump($articleModel->currentArticle('2', '1')); ?>
      </article>
    </div>
  </main>
  <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
</body>

</html>